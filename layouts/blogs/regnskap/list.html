{{ define "main" }}
<section class="py-6 sm:py-10">
  <div class="max-w-5xl mx-auto px-4 w-full">
    <h1 class="text-3xl font-semibold tracking-tight px-2 sm:px-0">Regnskap</h1>

    {{ $all := .CurrentSection.RegularPages.ByDate.Reverse }}
    {{ if gt (len $all) 0 }}
      <div class="mt-6 sm:mt-8 grid grid-cols-1 gap-4 sm:gap-6 w-full">
        {{ range $all }}
        {{ $page := . }}
        <article class="w-full rounded-xl ring-1 ring-gray-200 bg-white p-4 sm:p-5 flex gap-3 sm:gap-4">
          {{ $imgSrc := "" }}
          {{ $candidate := or $page.Params.featured_image (or $page.Params.image (or $page.Params.icon $page.Params.thumbnail)) }}
          {{ with $candidate }}
            {{ $feat := . }}
            {{ $s := newScratch }}
            {{ if or (hasPrefix $feat "/") (hasPrefix $feat "http") }}
              {{ $s.Set "src" $feat }}
            {{ else }}
              {{ $matches := $page.Resources.Match $feat }}
              {{ if gt (len $matches) 0 }}
                {{ with index $matches 0 }}
                  {{ $s.Set "src" .RelPermalink }}
                {{ end }}
              {{ else }}
                {{ $s.Set "src" (printf "%s%s" $page.RelPermalink $feat) }}
              {{ end }}
            {{ end }}
            {{ $imgSrc = $s.Get "src" }}
          {{ else }}
            {{ $imgSrc = "" }}
            {{ $m := $page.Resources.Match (printf "%s*-image.*" $page.Slug) }}
            {{ if gt (len $m) 0 }}
              {{ with index $m 0 }}{{ $imgSrc = .RelPermalink }}{{ end }}
            {{ else }}
              {{ $m = $page.Resources.Match "*-image.*" }}
              {{ if gt (len $m) 0 }}
                {{ with index $m 0 }}{{ $imgSrc = .RelPermalink }}{{ end }}
              {{ else }}
                {{ $m = $page.Resources.Match (printf "%s*.*" $page.Slug) }}
                {{ if gt (len $m) 0 }}
                  {{ with index $m 0 }}{{ $imgSrc = .RelPermalink }}{{ end }}
                {{ else }}
                  {{ $m = $page.Resources.Match "*image*.*" }}
                  {{ if gt (len $m) 0 }}
                    {{ with index $m 0 }}{{ $imgSrc = .RelPermalink }}{{ end }}
                  {{ end }}
                {{ end }}
              {{ end }}
            {{ end }}
          {{ end }}

          {{ with $imgSrc }}
            <img loading="lazy" src="{{ . }}" alt="{{ with $page.Params.featured_image_alt }}{{ . }}{{ else }}Illustrasjon{{ end }}" class="w-16 h-16 object-contain flex-shrink-0">
          {{ end }}
          <div class="min-w-0 flex-1 overflow-hidden">
            <h2 class="text-base sm:text-lg font-semibold text-gray-900 truncate">
              <a href="{{ .RelPermalink }}" class="hover:text-blue-600">{{ .Title }}</a>
            </h2>
            {{ with .Params.meta_description }}
              <p class="mt-1 text-sm sm:text-base text-gray-600 line-clamp-2 break-words">{{ . | markdownify | plainify }}</p>
            {{ else }}
              <p class="mt-1 text-sm sm:text-base text-gray-500 italic">Ingen beskrivelse tilgjengelig</p>
            {{ end }}
          </div>
        </article>
        {{ end }}
      </div>
    {{ else }}
      <p class="mt-4 text-gray-600">Ingen artikler funnet i denne kategorien enn√•.</p>
    {{ end }}
  </div>
</section>
{{ end }}