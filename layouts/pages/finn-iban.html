{{ define "main" }}
<section class="py-12">
  <div class="max-w-3xl mx-auto px-4">
    <h1 class="text-3xl md:text-4xl font-semibold tracking-tight">Finn IBAN-nummer via kontonummer</h1>
    <p class="mt-4 text-gray-700">Skriv inn ditt 11-sifrede norske kontonummer for å generere IBAN:</p>

    <div class="mt-6 rounded-xl ring-1 ring-gray-200 bg-white p-6">
      <div class="flex gap-3">
        <input id="konto" type="text" inputmode="numeric" pattern="[0-9]*" maxlength="11" placeholder="86011117947" class="flex-1 rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" />
        <button id="btn" class="inline-flex items-center rounded-md bg-indigo-600 px-4 py-2 text-white font-medium hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500">Beregn IBAN</button>
      </div>

      <div class="mt-4">
        <div class="text-sm text-gray-600">Ditt IBAN:</div>
        <div id="ibanOut" class="mt-1 text-lg font-mono font-semibold break-all"></div>
        <div id="err" class="mt-2 text-sm text-red-600" aria-live="polite"></div>
      </div>
    </div>

    <div class="mt-8 rounded-xl ring-1 ring-gray-200 bg-white p-6">
      <p class="text-gray-800">Prøv vårt gratis regnskapssystem <span class="font-medium">reai.no</span> idag. <a href="https://app.reai.no" class="text-indigo-600 underline" target="_blank" rel="noopener">Prøv gratis nå</a></p>
    </div>

    <div class="mt-10 prose prose-slate max-w-none">
      <h2>Er IBAN-Beregningen Korrekt?</h2>
      <p>Ja, beregningen i vår IBAN-kalkulator er korrekt for norske kontonummer. Den følger den standardiserte metoden for å generere IBAN basert på ISO 13616-standarden. La oss forklare det nærmere.</p>

      <h2>Hvordan Fungerer IBAN-Beregningen?</h2>
      <p>For Norge består IBAN av:</p>
      <ul>
        <li>Landskode: NO</li>
        <li>2 sjekksiffer (check digits)</li>
        <li>11-sifret kontonummer (BBAN: 4 siffer bankkode + 6 siffer konto + 1 nasjonalt sjekksiffer)</li>
      </ul>
      <p>Sjekksifrene beregnes ved å bruke MOD-97-algoritmen:</p>
      <ol>
        <li>Sett sammen kontonummeret + 'NO' + '00'.</li>
        <li>Konverter bokstaver til tall (A=10, B=11, osv.).</li>
        <li>Beregn modulo 97 av det store tallet.</li>
        <li>Sjekksiffer = 98 - resten.</li>
      </ol>
      <p>Denne metoden er enkel, men robust, og sikrer at IBAN er gyldig internasjonalt.</p>

      <h2>Er Beregningen den Samme for Alle Land?</h2>
      <p>Ja, selve algoritmen for å beregne sjekksifrene (MOD-97) er den samme for alle land som bruker IBAN. Imidlertid varierer strukturen og lengden på det nasjonale kontonummeret (BBAN) fra land til land. For eksempel:</p>
      <ul>
        <li>Norge: 11 siffer</li>
        <li>Tyskland: 18 siffer</li>
        <li>Storbritannia: 18 siffer, men med annen oppbygning</li>
      </ul>
      <p>Vår kalkulator er spesifikt tilpasset norske kontonummer, men prinsippet er universelt.</p>
    </div>
  </div>

  <script>
    (function(){
      const input = document.getElementById('konto');
      const btn = document.getElementById('btn');
      const out = document.getElementById('ibanOut');
      const err = document.getElementById('err');

      function onlyDigits(s){ return (s || '').replace(/\D+/g, ''); }

      function mod97(str){
        // Compute mod 97 for arbitrarily long string number
        let remainder = 0;
        for (let i = 0; i < str.length; i++) {
          const code = str.charCodeAt(i) - 48; // '0' -> 0
          if (code >= 0 && code <= 9) {
            remainder = (remainder * 10 + code) % 97;
          } else {
            // safety, though we only pass digits
          }
        }
        return remainder;
      }

      function lettersToDigits(s){
        // Convert letters to numbers A=10 ... Z=35
        return s.toUpperCase().replace(/[A-Z]/g, c => (c.charCodeAt(0) - 55).toString());
      }

      function computeIBAN_NO(account){
        const bban = onlyDigits(account);
        if (bban.length !== 11) return null;
        // Rearranged: BBAN + country + 00
        const rearranged = bban + lettersToDigits('NO') + '00';
        const rem = mod97(rearranged);
        const check = 98 - rem;
        const checkStr = check < 10 ? '0' + check : String(check);
        return 'NO' + checkStr + bban;
      }

      function group4(iban){
        return iban.replace(/(.{4})/g, '$1 ').trim();
      }

      function run(){
        err.textContent = '';
        out.textContent = '';
        const value = onlyDigits(input.value);
        if (value.length !== 11) {
          err.textContent = 'Ugyldig kontonummer. Må være 11 siffer.';
          return;
        }
        const iban = computeIBAN_NO(value);
        if (!iban){
          err.textContent = 'Ugyldig kontonummer. Må være 11 siffer.';
          return;
        }
        out.textContent = group4(iban);
      }

      btn.addEventListener('click', run);
      input.addEventListener('keydown', (e)=>{ if(e.key === 'Enter'){ e.preventDefault(); run(); }});
    })();
  </script>
</section>
{{ end }}
